layout {
    // Tab for cluster nodes
    tab name="Cluster" focus=true {
        pane split_direction="vertical" {
            pane name="Node 1" {
                command "nix"
                args "develop" "-c" "bash" "-c" "cd /home/brittonr/git/blixard && echo '=== Starting Cluster Node 1 ===' && gleam run -m service_manager -- --join-cluster"
            }
            pane name="Node 2" {
                command "nix"
                args "develop" "-c" "bash" "-c" "cd /home/brittonr/git/blixard && sleep 3 && echo '=== Starting Cluster Node 2 ===' && gleam run -m service_manager -- --join-cluster"
            }
        }
    }
    
    // Tab for service management
    tab name="Services" {
        pane split_direction="vertical" {
            pane name="Commands" size="60%" {
                command "nix"
                args "develop" "-c" "bash" "-c" "cd /home/brittonr/git/blixard && echo -e '\n=== Blixard Service Manager ===\n\nCommands:\n- gleam run -m service_manager -- list\n- gleam run -m service_manager -- start --user test-http-server\n- gleam run -m service_manager -- status --user test-http-server\n- gleam run -m service_manager -- stop --user test-http-server\n- gleam run -m service_manager -- list-cluster\n\nWait 5 seconds for cluster to start...\n' && sleep 5 && bash"
            }
            pane split_direction="horizontal" size="40%" {
                pane name="HTTP Test" {
                    command "bash" 
                    args "-c" "cd /home/brittonr/git/blixard && echo -e '\n=== HTTP Server Monitor ===\n\nThis pane will monitor the test HTTP server on port 8888\n\nCommands:\n- curl -s http://localhost:8888 | head -5\n- systemctl --user status test-http-server\n' && bash"
                }
                pane name="Logs" {
                    command "bash"
                    args "-c" "cd /home/brittonr/git/blixard && echo -e '\n=== Service Logs ===\n\nCommands:\n- journalctl --user -u test-http-server -f\n- systemctl --user status test-http-server\n' && bash"
                }
            }
        }
    }
    
    // Tab for monitoring
    tab name="Monitor" {
        pane split_direction="vertical" {
            pane name="Nodes" size="50%" {
                command "watch"
                args "-n" "2" "ps aux | grep beam.smp | grep -v grep | awk '{print $2, $11, $12, $13}' | column -t"
            }
            pane split_direction="horizontal" size="50%" {
                pane name="Services" {
                    command "watch"
                    args "-n" "3" "cd /home/brittonr/git/blixard && gleam run -m service_manager -- list 2>&1 | grep -A 20 'CLI-Managed Services' | head -30"
                }
                pane name="Network" {
                    command "watch" 
                    args "-n" "5" "netstat -tuln | grep beam"
                }
            }
        }
    }
    
    // Tab for debugging
    tab name="Debug" {
        pane name="REPL" {
            command "bash"
            args "-c" "cd /home/brittonr/git/blixard && echo -e '\n=== Debug Console ===\n\nUseful commands:\n- epmd -names  # Show registered Erlang nodes\n- gleam run -m service_manager -- list-cluster\n- killall beam.smp  # Kill all Erlang processes\n- ./scripts/test_cluster_with_service.sh  # Run full test\n\nStarting Gleam REPL in 3 seconds...\n' && sleep 3 && gleam repl"
        }
    }
}